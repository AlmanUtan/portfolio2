<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elia Römpler - Portfolio</title>
    <link rel="icon" type="image/png" href="public/img/IMG_6999.PNG" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://use.typekit.net/yyn5dss.css" />
  </head>

  <body>
    <!-- Move hamburger OUTSIDE the transformed .navigation -->
    <button
      class="hamburger"
      type="button"
      aria-label="Open menu"
      onclick="openMenu()"
      id="hamburgerBtn"
    >
      <div id="bar1" class="bar"></div>
      <div id="bar2" class="bar"></div>
      <div id="bar3" class="bar"></div>
    </button>

    <div class="navigation">
      <nav>
        <ul>
          <li>
            <a href="asterisk.html">Home</a>
          </li>
          <li>
            <a href="#" onclick="closeMenuAndOpenGallery(); return false;"
              >Gallery</a
            >
          </li>
          <li><a href="about.html">About</a></li>
        </ul>
      </nav>

      <div class="socials">
        <a
          href="https://www.linkedin.com/in/elia-r%C3%B6mpler-5b4b9823b/"
          target="_blank"
          >LinkedIn</a
        >
        <a href="https://www.instagram.com/elia.roempler/" target="_blank"
          >Instagram</a
        >
        <a href="elia.roempler@gmail.com" target="_blank">E-mail</a>
      </div>

      <div class="asterisk-image">
        <img src="public/img/IMG_6999.PNG" alt="asterisk" />
      </div>
    </div>
    <div id="page-transition-overlay"></div>
    <div id="canvas-container"></div>
    <button id="toggle-rotation-btn">Pause Rotation</button>
    <p id="instructions" class="instructions"></p>

    <!-- GALLERY OVERLAY -->
    <section id="galleryOverlay" aria-hidden="true">
      <div class="galleryScroll" id="galleryScroll" tabindex="-1">
        <div class="galleryGrid">
          <!-- Header row -->
          <header class="galleryRow galleryHeaderRow">
            <div class="galleryTitle">PROJECTS GALLERY</div>
            <button id="closeGalleryBtn" class="galleryClose" type="button">
              Close
            </button>
          </header>

          <div id="galleryList" class="organicGrid">
            <!-- Example cards (same as your original) -->
            <article
              class="projectCard"
              data-page="1"
              style="--card-ar: 16/9"
              data-tier="main"
            >
              <div class="cardPreview" style="--card-ar: 16/9">
                <span class="projectName">übertön</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/uberton.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 16/9">
                <!-- FULL-WIDTH HEADER VIDEO -->
                <div class="videoWrapper caseVideoWrap">
                  <!-- Title top-left -->
                  <div class="caseTitle">ÜBERTÖN</div>

                  <!-- Close arrow top-right -->
                  <button
                    class="caseCloseBtn"
                    type="button"
                    aria-label="Close project"
                  >
                    <span class="arrowParts">
                      <span class="arrow-bar arrow-bar-main"></span>
                      <span class="arrow-bar arrow-bar-diag"></span>
                      <span class="arrow-bar arrow-bar-tail"></span>
                    </span>
                  </button>

                  <!-- Fullscreen icon bottom-right -->
                  <button
                    class="caseFullscreenBtn"
                    type="button"
                    aria-label="Fullscreen video"
                  >
                    <span class="fs-box">
                      <span class="fs-corner fs-tl"></span>
                      <span class="fs-corner fs-tr"></span>
                      <span class="fs-corner fs-bl"></span>
                      <span class="fs-corner fs-br"></span>
                    </span>
                  </button>

                  <!-- 16:9 video -->
                  <video
                    class="caseVideo"
                    src="public/vid/%C3%BCbert%C3%B6n%20main%20(1920x1080).mp4"
                    autoplay
                    muted
                    loop
                    playsinline
                  ></video>
                </div>

                <!-- BODY: BLOBS + DESCRIPTION -->
                <div class="caseBody">
                  <div class="caseBody-left">
                    <!-- 3 BLOBS -->
                    <div class="caseBlobs">
                      <!-- Logo blob -->
                      <div class="caseBlob">
                        <div class="caseBlob-square">
                          <!-- replace with real logo image if you like -->
                          <img
                            src="public/img/placeholder-logo.png"
                            alt="Übertön logo"
                          />
                        </div>
                      </div>

                      <!-- Installation blob -->
                      <div class="caseBlob">
                        <div class="caseBlob-pill"># installation</div>
                      </div>

                      <!-- Audio reactive blob -->
                      <div class="caseBlob">
                        <div class="caseBlob-pill"># audio reactive</div>
                      </div>
                    </div>
                  </div>

                  <div class="caseBody-right">
                    <!-- Description -->
                    <div class="projectDescription projectDescription--wide">
                      <h3>Description</h3>
                      <p>
                        Übertön is an audio-visual installation that merges
                        sound and light into a single physical object. It is
                        made up of two giant custom-made foam panel speakers
                        that span a combined area of over 1.3 m², on which
                        real-time audio visualisations are projected. The
                        diffuse sound profile paired with live visuals makes for
                        a unique experience that makes the music feel more
                        tangible.
                      </p>
                    </div>
                  </div>
                </div>

                <!-- 4 DETAIL VIDEOS ROW -->
                <div class="caseDetailVideos">
                  <!-- VIDEO 1 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail1-thumb.jpg"
                        alt="Übertön detail 1"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail1.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>

                  <!-- VIDEO 2 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail2-thumb.jpg"
                        alt="Übertön detail 2"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail2.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>

                  <!-- VIDEO 3 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail3-thumb.jpg"
                        alt="Übertön detail 3"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail3.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>

                  <!-- VIDEO 4 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail4-thumb.jpg"
                        alt="Übertön detail 4"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail4.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>
                </div>

                <!-- IN DETAIL SECTION -->
                <div class="caseDetailSection">
                  <div class="caseDetail-left">
                    <h3 class="caseDetail-heading">In Detail</h3>
                    <div class="caseDetail-text">
                      <p>
                        The concept for this project was to create an audio safe
                        space that allows people to shut off from their routine
                        day and offer a listening experience that really pulls
                        you in, drowning out the noisiness and stress of your
                        day (/[ger]:über·tön &gt; to outsound smth/).
                      </p>
                      <p>
                        This idea was developed while delving into research on
                        the psychology of music listening. I was intrigued by
                        its influence on our minds and feelings, and aimed to
                        create an environment that takes the music centre stage,
                        giving it the most potential for its power.
                      </p>
                      <p>
                        A key factor in this was to enhance the listening
                        through expanding the sensory experience by creating
                        different real-time audio-reactive visuals that match
                        the tone of the played music. This draws the attention
                        of the viewer directly to the source of sound, while
                        also keeping them intrigued with the audiovisual
                        synchronisation they can directly observe on the
                        speaker's surface.
                      </p>
                      <p>
                        Giving the music a visual character felt especially
                        crucial for this project, since nowadays music often
                        slips into the background, while we´re busy following
                        our daily lives. Übertön claims back a spot just for
                        music.
                      </p>
                      <p>
                        This back-claiming is also happening quite literally
                        through the sonic profile of the flat panel speaker.
                        They don´t only excel in their super clear mid-range
                        frequencies, but furthermore have a unique diffuse,
                        room-filling sound profile that takes up the full room
                        with its soundwaves.
                      </p>
                    </div>
                  </div>

                  <div class="caseDetail-right">
                    <div class="caseDetail-imageWrap">
                      <img
                        src="public/img/ubertoen-detail-main.jpg"
                        alt="Übertön installation photo"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </article>

            <article
              class="projectCard"
              data-page="2"
              style="--card-ar: 16/9"
              data-tier="main"
            >
              <div class="cardPreview" style="--card-ar: 16/9">
                <span class="projectName">wdtw</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/wdtwcover.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 16/9">
                <div class="videoWrapper caseVideoWrap">
                  <div class="caseTitle">wdtw</div>
                  <button
                    class="caseCloseBtn"
                    type="button"
                    aria-label="Close project"
                  >
                    <span class="arrowParts">
                      <span class="arrow-bar arrow-bar-main"></span>
                      <span class="arrow-bar arrow-bar-diag"></span>
                      <span class="arrow-bar arrow-bar-tail"></span>
                    </span>
                  </button>
                  <button
                    class="caseFullscreenBtn"
                    type="button"
                    aria-label="Fullscreen video"
                  >
                    <span class="fs-box">
                      <span class="fs-corner fs-tl"></span>
                      <span class="fs-corner fs-tr"></span>
                      <span class="fs-corner fs-bl"></span>
                      <span class="fs-corner fs-br"></span>
                    </span>
                  </button>
                  <video
                    class="caseVideo"
                    src="public/vid/wdtwcover.mp4"
                    autoplay
                    muted
                    loop
                    playsinline
                  ></video>
                </div>

                <!-- BODY: BLOBS + DESCRIPTION -->
                <div class="caseBody">
                  <div class="caseBody-left">
                    <!-- 3 BLOBS -->
                    <div class="caseBlobs">
                      <!-- Logo blob -->
                      <div class="caseBlob">
                        <div class="caseBlob-square">
                          <!-- replace with real logo image if you like -->
                          <img
                            src="public/img/placeholder-logo.png"
                            alt="Übertön logo"
                          />
                        </div>
                      </div>

                      <!-- Installation blob -->
                      <div class="caseBlob">
                        <div class="caseBlob-pill"># installation</div>
                      </div>

                      <!-- Audio reactive blob -->
                      <div class="caseBlob">
                        <div class="caseBlob-pill"># audio reactive</div>
                      </div>
                    </div>
                  </div>

                  <div class="caseBody-right">
                    <!-- Description -->
                    <div class="projectDescription projectDescription--wide">
                      <h3>Description</h3>
                      <p>
                        For the WDTW25 Afterparty, I got commissioned to be a VJ to support the DJ lineup visually. Working together with peers from my university, we created multiple distinct audio-reactive visuals for each DJ. The work that you can see here was my contribution to the project.

                      </p>
                    </div>
                  </div>
                </div>

                <!-- 4 DETAIL VIDEOS ROW -->
                <div class="caseDetailVideos">
                  <!-- VIDEO 1 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail1-thumb.jpg"
                        alt="Übertön detail 1"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail1.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>

                  <!-- VIDEO 2 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail2-thumb.jpg"
                        alt="Übertön detail 2"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail2.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>

                  <!-- VIDEO 3 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail3-thumb.jpg"
                        alt="Übertön detail 3"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail3.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>

                  <!-- VIDEO 4 -->
                  <div class="detailVideoCard">
                    <div class="detailVideoInner">
                      <img
                        class="detailVideoThumb"
                        src="public/img/ubertoen-detail4-thumb.jpg"
                        alt="Übertön detail 4"
                      />
                      <video
                        class="detailVideoHover"
                        src="public/vid/ubertoen-detail4.mp4"
                        muted
                        playsinline
                        preload="metadata"
                      ></video>
                    </div>
                  </div>
                </div>

                <!-- IN DETAIL SECTION -->
                <div class="caseDetailSection">
                  <div class="caseDetail-left">
                    <h3 class="caseDetail-heading">In Detail</h3>
                    <div class="caseDetail-text">
                      <p>
                        WDTW (We Design The World) is an annual event of NHL Stenden, celebrating its creative studies with a week full of interesting lectures, workshops, expos, and a big afterparty to connect different creative fields within the university
                      </p>
                      <p>
                        Our team of 3 students, including me, was responsible for VJing for this event. None of us had prior experience in this, but we were all familiar with the basics of TouchDesigner, so we settled on using that program over something like Resolume, which is usually the more common choice.
                      </p>
                      <p>
                        Even though TouchDesigner is not specifically made for VJing, it has the advantage of its real-time rendering, meaning we can make actual live audio-reactive visuals, instead of adjusting prerendered video clips during the live performance. For our project, that means most of the work takes place ahead of the event, creating node setups that match the music that will be played, and only doing small adjustments during the sets themselves.
                      </p>
                      <p>
                        Giving the music a visual character felt especially
                        crucial for this project, since nowadays music often
                        slips into the background, while we´re busy following
                        our daily lives. Übertön claims back a spot just for
                        music.
                      </p>
                      <p>
                        So to be able to create these fitting networks for the visuals, we got in contact with each DJ, asking for concrete setlists to base our moodboards on. Each DJ was playing a different type of genre, starting with light house beats and moving all the way to hard techno over the course of the night.
                      </p>
                      <p>
                        My part in the project was not only to create two of the main visuals for the last two DJs, but more importantly, to create a project setup, allowing us to even VJ inside TouchDesigner, since, as already mentioned, the program is not specifically made for that. That meant I built an in-depth audio-analysis tool that could be used to instance each individual visual, but furthermore drove the whole project by acting as a main controller over each DJ's multiple visuals, switching between them, and inserting (also audio-reactive) title cards with the name of the event.
                      </p>
                    </div>
                  </div>
              </div>
            </article>

            <article
              class="projectCard"
              data-page="3"
              style="--card-ar: 16/9"
              data-tier="main"
            >
              <div class="cardPreview" style="--card-ar: 16/9">
                <span class="projectName">giftedness</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/gift.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 16/9">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/giftedness%20%281920x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>

                <div class="projectDescription">
                  <h3>Description</h3>
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Duis posuere condimentum tellus eget tristique.
                  </p>
                </div>
                <div class="projectProcess">
                  <h3>Process</h3>
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                    Repellendus deleniti, autem explicabo quisquam numquam
                    accusamus.
                  </p>
                </div>
              </div>
            </article>

            <article
              class="projectCard"
              data-page="4"
              style="--card-ar: 16/9"
              data-tier="main"
            >
              <div class="cardPreview" style="--card-ar: 16/9">
                <span class="projectName">Nacht in Contrast</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/nachtInContrast.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 16/9">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/nachtInContrast%20%281920x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>

                <div class="projectDescription">
                  <h3>Description</h3>
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Duis posuere condimentum tellus eget tristique.
                  </p>
                </div>
                <div class="projectProcess">
                  <h3>Process</h3>
                  <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                    Repellendus deleniti, autem explicabo quisquam numquam
                    accusamus.
                  </p>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="5" style="--card-ar: 2/3">
              <div class="cardPreview" style="--card-ar: 2/3">
                <span class="projectName">3d audio spectrum</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%201%20%281240x1536%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 2/3">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%201%20%281240x1536%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="6" style="--card-ar: 1/1">
              <div class="cardPreview" style="--card-ar: 1/1">
                <span class="projectName">cursor feedback</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%202%20%281080x1080%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1/1">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%202%20%281080x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article
              class="projectCard"
              data-page="7"
              style="--card-ar: 1080/576"
            >
              <div class="cardPreview" style="--card-ar: 1080/576">
                <span class="projectName">blob tracker</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%203%20%281080x576%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1080/576">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%203%20%281080x576%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="8" style="--card-ar: 1/1">
              <div class="cardPreview" style="--card-ar: 1/1">
                <span class="projectName">ASCII</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%204%20%281080x1080%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1/1">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%204%20%281080x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="9" style="--card-ar: 16/9">
              <div class="cardPreview" style="--card-ar: 16/9">
                <span class="projectName">glitch switch</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/glitch.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 16/9">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%205%20%281280x720%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="10" style="--card-ar: 1/1">
              <div class="cardPreview" style="--card-ar: 1/1">
                <span class="projectName">asteriks</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoadextra%207%20%281080x1080%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1/1">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%207%20%281080x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="11" style="--card-ar: 16/9">
              <div class="cardPreview" style="--card-ar: 16/9">
                <span class="projectName">circuit bend</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%206%20%281280x720%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 16/9">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%206%20%281280x720%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="12" style="--card-ar: 1/1">
              <div class="cardPreview" style="--card-ar: 1/1">
                <span class="projectName">particle cloud 1</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%208%20%281080x1080%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1/1">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%208%20%281080x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article
              class="projectCard"
              data-page="13"
              style="--card-ar: 640/720"
            >
              <div class="cardPreview" style="--card-ar: 640/720">
                <span class="projectName">hand tracking</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra%209%20%28640x720%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 640/720">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%209%20%28640x720%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="14" style="--card-ar: 1/1">
              <div class="cardPreview" style="--card-ar: 1/1">
                <span class="projectName">ASCII 2</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/ascii2.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1/1">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra%2010%20%281080x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>

            <article class="projectCard" data-page="15" style="--card-ar: 1/1">
              <div class="cardPreview" style="--card-ar: 1/1">
                <span class="projectName">tanzen</span>
                <video
                  class="previewVideo"
                  src="public/videoSmallLoad/extra11%20%281080x1080%29.mp4"
                  muted
                  playsinline
                  preload="none"
                ></video>
              </div>

              <div class="cardDetails" style="--video-ar: 1/1">
                <div class="videoWrapper">
                  <video
                    class="detailVideo"
                    controls
                    playsinline
                    preload="metadata"
                  >
                    <source
                      src="public/vid/extra11%20%281080x1080%29.mp4"
                      type="video/mp4"
                    />
                  </video>
                </div>
                <div class="cardHashtags">
                  <span class="hashtagBlob">#creative</span>
                  <span class="hashtagBlob">#motion</span>
                  <span class="hashtagBlob">#design</span>
                </div>
              </div>
            </article>
          </div>
        </div>
      </div>
    </section>

    <!-- Gallery CTA bar -->
    <div
      id="galleryCTA"
      role="button"
      aria-label="Open full gallery"
      tabindex="0"
    >
      Click to see the full gallery
    </div>

    <!-- Your UI/gallery/masonry JS -->
    <script src="script.js"></script>

    <!-- 3D app -->
    <script type="module">
      import * as THREE from "https://esm.sh/three@0.160.0";
      import { OrbitControls } from "https://esm.sh/three@0.160.0/examples/jsm/controls/OrbitControls.js";
      import { EffectComposer } from "https://esm.sh/three@0.160.0/examples/jsm/postprocessing/EffectComposer.js";
      import { RenderPass } from "https://esm.sh/three@0.160.0/examples/jsm/postprocessing/RenderPass.js";
      import { OutlinePass } from "https://esm.sh/three@0.160.0/examples/jsm/postprocessing/OutlinePass.js";
      import { OutputPass } from "https://esm.sh/three@0.160.0/examples/jsm/postprocessing/OutputPass.js";

      const easeInOutCubic = (t) =>
        t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;

      class SceneManager {
        constructor(container) {
          this.container = container;
          this.scene = new THREE.Scene();
          this.scene.background = null;

          this.setupRenderer();
          this.setupCamera();
          this.setupLighting();
          this.setupControls();
          this.setupPostFX();

          this.animationCallbacks = [];

          this.raycaster = new THREE.Raycaster();
          this.mouse = new THREE.Vector2();

          this.isDragging = false;
          this.mouseDownPos = { x: 0, y: 0 };
          this.mouseUpPos = { x: 0, y: 0 };
        }

        setupPostFX() {
          this.composer = new EffectComposer(this.renderer);
          this.renderPass = new RenderPass(this.scene, this.camera);
          this.composer.addPass(this.renderPass);

          this.outlinePass = new OutlinePass(
            new THREE.Vector2(window.innerWidth, window.innerHeight),
            this.scene,
            this.camera
          );
          this.outlinePass.edgeStrength = 3.0;
          this.outlinePass.edgeThickness = 1.5;
          this.outlinePass.pulsePeriod = 0.0;
          this.outlinePass.visibleEdgeColor.set(0xffffff);
          this.outlinePass.hiddenEdgeColor.set(0x000000);
          this.composer.addPass(this.outlinePass);

          this.outputPass = new OutputPass();
          this.composer.addPass(this.outputPass);
        }

        enableOutlineFor(objs) {
          if (!this.outlinePass) return;
          this.outlinePass.selectedObjects = Array.isArray(objs)
            ? objs
            : [objs];
        }

        setupRenderer() {
          this.renderer = new THREE.WebGLRenderer({
            antialias: true,
            alpha: true,
          });
          this.renderer.outputColorSpace = THREE.SRGBColorSpace;
          this.renderer.toneMapping = THREE.NoToneMapping;
          this.renderer.setSize(window.innerWidth, window.innerHeight);
          this.renderer.setPixelRatio(window.devicePixelRatio);
          this.container.appendChild(this.renderer.domElement);

          window.addEventListener("resize", () => this.onWindowResize());

          window.addEventListener("mousemove", (event) =>
            this.onMouseMove(event)
          );
          this.renderer.domElement.addEventListener("mousedown", (event) =>
            this.onMouseDown(event)
          );
          this.renderer.domElement.addEventListener("mouseup", (event) =>
            this.onMouseUp(event)
          );

          this.renderer.setClearAlpha(0);
        }

        setupCamera() {
          this.camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
          );
          this.initialPosition = new THREE.Vector3(0, 0, 0.5);
          this.initialLookAt = new THREE.Vector3(0, 0, 0);
          this.camera.position.copy(this.initialPosition);
          this.camera.lookAt(this.initialLookAt);
        }

        setupLighting() {
          const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
          this.scene.add(ambientLight);

          const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
          directionalLight.position.set(1, 1, 1);
          this.scene.add(directionalLight);
        }

        setupControls() {
          this.controls = new OrbitControls(
            this.camera,
            this.renderer.domElement
          );
          this.controls.enablePan = false;
          this.controls.enableZoom = true;
          this.controls.minDistance = 0.5;
          this.controls.maxDistance = 8.0;
          this.controls.enableDamping = true;
          this.controls.dampingFactor = 0.18;
          this.controls.rotateSpeed = 0.9;
          this.controls.autoRotate = false;
          this.controls.enableKeys = true;
          this.controls.screenSpacePanning = false;
          this.controls.minPolarAngle = 0;
          this.controls.maxPolarAngle = Math.PI;
        }

        onMouseMove(event) {
          this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
          this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        onMouseDown(event) {
          this.isDragging = false;
          this.mouseDownPos = { x: event.clientX, y: event.clientY };
        }

        onMouseUp(event) {
          this.mouseUpPos = { x: event.clientX, y: event.clientY };
          const dx = this.mouseUpPos.x - this.mouseDownPos.x;
          const dy = this.mouseUpPos.y - this.mouseDownPos.y;
          const dragDistance = Math.sqrt(dx * dx + dy * dy);
          if (dragDistance < 5) this.handleClick(event);
        }

        handleClick() {
          this.raycaster.setFromCamera(this.mouse, this.camera);
          const intersects = this.raycaster.intersectObjects(
            this.scene.children,
            true
          );
          if (intersects.length > 0) {
            const intersectedObject = intersects[0].object;
            if (
              intersectedObject.userData &&
              intersectedObject.userData.pageNumber
            ) {
              openSubpage(intersectedObject.userData.pageNumber);
            }
          }
        }

        addObject(object) {
          this.scene.add(object);
        }

        addAnimationCallback(callback) {
          this.animationCallbacks.push(callback);
        }

        animate() {
          requestAnimationFrame(() => this.animate());

          const isGalleryOpen = !!(
            window.App && window.App.galleryProgress >= 0.98
          );
          const introOverlayVisible = !!(
            window.App && window.App.overlayActive
          );

          this.controls.update();

          this.animationCallbacks.forEach((cb) => cb());

          if (!isGalleryOpen && !introOverlayVisible) {
            this.composer.render();
          }
        }

        onWindowResize() {
          this.camera.aspect = window.innerWidth / window.innerHeight;
          this.camera.updateProjectionMatrix();
          this.renderer.setSize(window.innerWidth, window.innerHeight);
          this.composer.setSize(window.innerWidth, window.innerHeight);
        }
      }

      class AsteriskCreator {
        static createAsterisk(size = 1.5, color = 0x000000) {
          const group = new THREE.Group();

          const armLength = size * 1.6;
          const armWidth = size * 0.35;
          const armDepth = size * 0.45;

          const fillMat = new THREE.MeshLambertMaterial({
            color,
            emissive: 0x000000,
            emissiveIntensity: 0.0,
            toneMapped: false,
          });

          for (let i = 0; i < 6; i++) {
            const geom = new THREE.BoxGeometry(armLength, armWidth, armDepth);
            const arm = new THREE.Mesh(geom, fillMat);
            arm.rotation.z = (Math.PI / 3) * i;
            group.add(arm);
          }

          group.userData.rotationSpeed = 0.01;
          return group;
        }
      }

      class OrbitingRectanglesManager {
        constructor(radius = 2.2, baseSurfaceArea = 1.44) {
          this.group = new THREE.Group();
          this.rects = [];
          this.videos = [];

          const videoEntries = [
            {
              src: "public/vid/videoSmallLoad/ton1.mp4",
              page: 1,
              aspect: 1 / 1,
            },
            {
              src: "public/vid/videoSmallLoad/wdtw1.mp4",
              page: 2,
              aspect: 16 / 9,
            },
            {
              src: "public/vid/videoSmallLoad/wdtw2.mp4",
              page: 2,
              aspect: 16 / 9,
            },
            {
              src: "public/vid/videoSmallLoad/nacht.mp4",
              page: 4,
              aspect: 16 / 9,
            },
            {
              src: "public/vid/videoSmallLoad/extra%201%20%281240x1536%29.mp4",
              page: 5,
              aspect: 2 / 3,
            },
            {
              src: "public/vid/videoSmallLoad/ton2.mp4",
              page: 1,
              aspect: 9 / 16,
            },
            {
              src: "public/vid/videoSmallLoad/extra2.mp4",
              page: 6,
              aspect: 1 / 1,
            },
            {
              src: "public/vid/videoSmallLoad/extra%204%20%281080x1080%29.mp4",
              page: 8,
              aspect: 1 / 1,
            },
          ];

          if (!videoEntries.length) return;

          const totalRects = videoEntries.length;
          const minRadius = radius * 1.1;
          const maxRadius = radius * 1.22;

          for (let i = 0; i < totalRects; i++) {
            const entry = videoEntries[i];
            const pageNumber = entry.page;
            const rectAspect = entry.aspect;

            const width = Math.sqrt(baseSurfaceArea * rectAspect);
            const height = Math.sqrt(baseSurfaceArea / rectAspect);

            const t = i / totalRects;
            const inclination = Math.acos(1 - 2 * t);
            const azimuth = Math.PI * (1 + Math.sqrt(5)) * i;
            const jitter = (Math.random() - 0.5) * 0.22;
            const r = minRadius + (maxRadius - minRadius) * t + jitter;
            const px = r * Math.sin(inclination) * Math.cos(azimuth);
            const py = r * Math.cos(inclination);
            const pz = r * Math.sin(inclination) * Math.sin(azimuth);

            const vid = document.createElement("video");
            vid.dataset.src = entry.src;
            vid.muted = true;
            vid.loop = true;
            vid.playsInline = true;
            vid.preload = "none";
            this.videos.push(vid);

            const vtex = new THREE.VideoTexture(vid);
            vtex.colorSpace = THREE.SRGBColorSpace;
            vtex.minFilter = THREE.LinearFilter;
            vtex.magFilter = THREE.LinearFilter;

            const geometry = new THREE.PlaneGeometry(width, height);
            const material = new THREE.MeshBasicMaterial({
              map: vtex,
              side: THREE.FrontSide,
              toneMapped: false,
            });

            const rect = new THREE.Mesh(geometry, material);
            rect.position.set(px, py, pz);
            rect.lookAt(0, 0, 0);
            rect.userData.pageNumber = pageNumber;

            const squareSize = 0.13;
            const squareGeo = new THREE.PlaneGeometry(squareSize, squareSize);
            const squareMat = new THREE.MeshBasicMaterial({
              color: 0xff2222,
              side: THREE.FrontSide,
            });

            const corners = [
              [-width / 2, height / 2],
              [width / 2, height / 2],
              [-width / 2, -height / 2],
              [width / 2, -height / 2],
            ];

            for (const [cx, cy] of corners) {
              const sq = new THREE.Mesh(squareGeo, squareMat);
              rect.add(sq);
              sq.position.set(cx, cy, 0.02);
            }

            this.group.add(rect);
            this.rects.push(rect);
          }

          this.group.rotation.y = Math.PI / 8;
        }

        animate(opposite = false) {
          const dir = opposite ? -1 : 1;
          this.group.rotation.y += dir * 0.01;
          this.group.rotation.x += dir * 0.005;
        }

        pause() {
          this.videos.forEach((v) => {
            try {
              v.pause();
            } catch (_) {}

            if (window.App?.overlayActive) {
              v.removeAttribute("src");
              try {
                v.load();
              } catch (_) {}
            }
          });
        }

        resume() {
          this.videos.forEach((v) => {
            try {
              if (!v.src && v.dataset.src) {
                v.src = v.dataset.src;
                v.preload = "metadata";
                v.load();
              }
              v.muted = true;
              const p = v.play();
              if (p && typeof p.then === "function") p.catch(() => {});
            } catch (_) {}
          });
        }
      }

      class App {
        constructor() {
          this.container = document.getElementById("canvas-container");
          this.sceneManager = new SceneManager(this.container);
          this.toggleBtn = document.getElementById("toggle-rotation-btn");

          this.rotationEnabled = true;
          this.scrollAccumulator = 100;
          this.maxOverlayScroll = 100;
          this.maxZoomScroll = 400;
          this.targetScroll = 100;
          this.scrollVelocity = 0;
          this.lastFrameTime = performance.now();
          this.overlayShowThreshold = 0.94;
          this.overlayHideThreshold = 0.98;

          this.asterisk = AsteriskCreator.createAsterisk(1.5, 0x000000);
          this.sceneManager.addObject(this.asterisk);
          this.sceneManager.enableOutlineFor(this.asterisk);
          this.orbitingRects = new OrbitingRectanglesManager();
          this.sceneManager.addObject(this.orbitingRects.group);

          this.overlay = null;
          this.overlayActive = false;

          this.introVideo = null;
          this.introPlayBtn = null;
          this.introMuteBtn = null;

          this.introPlaying = !!this.introVideo;
          this.lastVideoTime = 0;
          this.lastOverlayHideAt = null;
          this.userApprovedAudio = false;

          this.galleryEl = document.getElementById("galleryOverlay");
          this.galleryScroller = document.getElementById("galleryScroll");
          this.closeGalleryBtn = document.getElementById("closeGalleryBtn");
          if (this.closeGalleryBtn) {
            this.closeGalleryBtn.addEventListener("click", () =>
              this.closeGallery()
            );
          }

          this.galleryCTA = document.getElementById("galleryCTA");
          if (this.galleryCTA) {
            this.galleryCTA.addEventListener("click", () => this.openGallery());
            this.galleryCTA.addEventListener("keydown", (e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                this.openGallery();
              }
            });
          }

          this.setupUI();
          this.setupScroll();
          this.addRotateListeners();

          this.sceneManager.addAnimationCallback(() => this.animateAsterisk());
          this.sceneManager.addAnimationCallback(() => this.animateRects());
          this.sceneManager.addAnimationCallback(() => this.smoothScrollStep());
          this.sceneManager.addAnimationCallback(() =>
            this.billboardVideosToCamera()
          );

          this.sceneManager.animate();

          this.isRotating = false;
          this.preRotateZoom = null;
          this.zoomOutFactor = 2.2;
          this.zoomLerp = 0;
          this.currentZoom = null;
          this.targetZoom = null;

          this.shouldOrientAsterisk = false;
          this.controlsStartBufferMs = 180;
          this.rotateStartTimer = null;

          this.galleryProgress = 0;
          this.galleryProgressTarget = 0;
          this.galleryPull = 0;
          this.galleryDeadSpace = 800;
          this.galleryLift = 1;

          this.autoScrollTween = null;
          this.heavyPaused = false;

          if (this.orbitingRects) {
            if (this.overlayActive) {
              this.orbitingRects.pause();
            } else {
              this.orbitingRects.resume();
            }
          }

          const urlParams = new URLSearchParams(window.location.search);
          const entryMode = urlParams.get("from");

          if (entryMode === "nav") {
            this.overlayActive = false;
            if (this.overlay) {
              this.overlay.classList.add("hidden");
              this.overlay.style.opacity = "0";
            }
            if (this.introVideo) {
              this.introVideo.style.opacity = "0";
              this.introVideo.pause();
            }

            this.scrollAccumulator =
              this.maxOverlayScroll + this.maxZoomScroll * 0.9;
            this.targetScroll = this.scrollAccumulator;
            this.scrollVelocity = 0;
            this.mobileZoomLocked = this.isMobilePortrait;
            this.updateCTAVisibility();
          }

          this.updateMuteButtonIcon?.();

          this._lastTapTime = 0;
          this._lastTapX = 0;
          this._lastTapY = 0;

          if (this.overlay) {
            this.overlay.addEventListener(
              "touchend",
              (e) => {
                if (
                  e.target &&
                  e.target.closest &&
                  e.target.closest("#introPlayBtn, #introMuteToggle")
                )
                  return;

                const touch = (e.changedTouches && e.changedTouches[0]) || null;
                const now = performance.now();

                if (touch) {
                  const x = touch.clientX,
                    y = touch.clientY;
                  const dt = now - this._lastTapTime;
                  const dx = x - this._lastTapX;
                  const dy = y - this._lastTapY;
                  const dist2 = dx * dx + dy * dy;

                  if (dt < 300 && dist2 < 400) {
                    e.preventDefault();
                    this.onIntroVideoEnd?.();
                    if (this.isMobilePortrait) this.mobileZoomLocked = true;
                  }

                  this._lastTapTime = now;
                  this._lastTapX = x;
                  this._lastTapY = y;
                } else {
                  const dt = now - this._lastTapTime;
                  if (dt < 300) {
                    e.preventDefault();
                    this.onIntroVideoEnd?.();
                    if (this.isMobilePortrait) this.mobileZoomLocked = true;
                  }
                  this._lastTapTime = now;
                }
              },
              { passive: false }
            );
          }

          this.isMobilePortrait = this.computeMobilePortrait();
          this.mobileZoomLocked = false;

          window.addEventListener("resize", () => {
            const wasMobile = this.isMobilePortrait;
            this.isMobilePortrait = this.computeMobilePortrait();
            if (this.isMobilePortrait !== wasMobile) {
              this.applyMobileControls();
              if (this.isMobilePortrait) {
                this.targetScroll = this.maxOverlayScroll + this.maxZoomScroll;
                this.scrollAccumulator = this.targetScroll;
                this.scrollVelocity = 0;
                this.autoScrollTween = null;
                this.mobileZoomLocked = true;
                this.updateGalleryFrame(1);
                this.updateCTAVisibility();
              } else {
                this.autoScrollToFraction(0.62, 3500);
              }
            }
          });
          window.addEventListener("orientationchange", () => {
            this.isMobilePortrait = this.computeMobilePortrait();
            this.applyMobileControls();
          });

          setTimeout(() => {
            if (this.isMobilePortrait) {
              this.autoScrollToFraction(1.0, 2000);
              this.mobileZoomLocked = true;
            } else {
              this.autoScrollToFraction(0.62, 3500);
            }
          }, 100);

          this.applyMobileControls();
        }

        pauseHeavy() {
          if (this.heavyPaused) return;
          if (this.orbitingRects) this.orbitingRects.pause();
          if (this.introVideo) {
            try {
              this.introVideo.pause();
            } catch (_) {}
          }
          this.heavyPaused = true;
        }

        resumeHeavy() {
          if (!this.heavyPaused) return;
          if (this.orbitingRects) this.orbitingRects.resume();
          this.heavyPaused = false;
        }

        modalIsOpen() {
          const m = document.getElementById("projectModal");
          return !!(m && m.classList.contains("is-open"));
        }

        eventIsInsideModal(e) {
          const t = e.target;
          if (t && typeof t.closest === "function") {
            if (t.closest("#projectModal")) return true;
          }
          const path = e.composedPath ? e.composedPath() : [];
          return path.some(
            (el) => el && el.nodeType === 1 && el.id === "projectModal"
          );
        }

        updateMuteButtonIcon() {
          if (!this.introMuteBtn || !this.introVideo) return;
          this.introMuteBtn.textContent = this.introVideo.muted ? "🔇" : "🔊";
        }

        onOverlayShown() {
          this.orbitingRects?.pause();
          if (this.introPlayBtn) {
            this.introPlayBtn.hidden = true;
            this.introPlayBtn.style.display = "none";
          }
          if (!this.introVideo) return;

          const now = performance.now();
          const recentlyHidden =
            this.lastOverlayHiddenAt && now - this.lastOverlayHiddenAt <= 10000;

          const prevMuted = this.introVideo.muted;
          this.introVideo.muted = true;

          const resumeOrRestart = () => {
            try {
              if (
                recentlyHidden &&
                !this.introVideo.ended &&
                this.introVideo.currentTime > 0
              ) {
                this.introVideo
                  .play()
                  ?.then(() => {
                    this.introVideo.muted = prevMuted;
                  })
                  .catch(() => {});
              } else {
                this.introVideo.currentTime = 0;
                this.introVideo
                  .play()
                  ?.then(() => {
                    this.introVideo.muted = prevMuted;
                  })
                  .catch(() => {});
              }
            } catch (e) {}
          };
          this.updateCTAVisibility();
          resumeOrRestart();
        }

        onOverlayHidden() {
          this.orbitingRects?.resume();
          this.lastOverlayHiddenAt = performance.now();
          const v = this.introVideo;
          if (!v) return;
          this.lastVideoTime = v.currentTime || 0;
          v.pause();
          this.introPlaying = false;
          this.updateCTAVisibility();
        }

        skipIntro(cause = "scroll") {
          if (!this.overlay) return;
          if (!this.overlayActive) return;

          this.overlay.classList.add("hidden");
          this.overlayActive = false;
          this.onOverlayHidden();

          if (cause !== "ended") {
            const smallNudge = this.maxOverlayScroll * 0.25;
            this.targetScroll = Math.min(
              this.maxOverlayScroll + this.maxZoomScroll,
              this.targetScroll + smallNudge
            );
          }
        }

        onIntroVideoEnd() {
          if (!this.overlay || !this.overlayActive) return;

          const v = this.introVideo;
          if (v) {
            try {
              v.loop = false;
              v.pause();
            } catch (_) {}
          }

          this.overlay.classList.add("hidden");
          this.overlayActive = false;
          this.onOverlayHidden();

          const epsilon = 2;
          const minPostEnd =
            this.overlayShowThreshold * this.maxOverlayScroll + epsilon;
          if (this.scrollAccumulator < minPostEnd) {
            this.scrollAccumulator = minPostEnd;
            this.targetScroll = Math.max(this.targetScroll, minPostEnd);
            this.scrollVelocity = 0;
          }

          if (this.isMobilePortrait) {
            this.autoScrollToFraction(1.0, 3000);
            this.targetScroll = this.maxOverlayScroll + this.maxZoomScroll;
            this.mobileZoomLocked = true;

            setTimeout(() => {
              this.scrollAccumulator =
                this.maxOverlayScroll + this.maxZoomScroll;
              this.targetScroll = this.scrollAccumulator;
              this.scrollVelocity = 0;
            }, 900);
          } else {
            this.autoScrollToFraction(0.6, 3000);
            this.targetScroll = this.maxOverlayScroll + this.maxZoomScroll;
          }
        }

        autoScrollToFraction(fraction, durationMs = 3000) {
          const clamped = Math.max(0, Math.min(1, fraction));
          const target = this.maxOverlayScroll + this.maxZoomScroll * clamped;

          this.autoScrollTween = {
            start: this.targetScroll,
            end: target,
            startTime: performance.now(),
            duration: durationMs,
          };
        }

        setupUI() {
          this.toggleBtn.addEventListener("click", () => {
            this.rotationEnabled = !this.rotationEnabled;
            this.toggleBtn.textContent = this.rotationEnabled
              ? "Pause Rotation"
              : "Resume Rotation";
          });

          window.addEventListener("keydown", (e) => {
            if (e.code === "Space" || e.key === " ") {
              e.preventDefault();
              this.rotationEnabled = !this.rotationEnabled;
              this.toggleBtn.textContent = this.rotationEnabled
                ? "Pause Rotation"
                : "Resume Rotation";
            }
          });
        }

        atZoomEnd() {
          const end = this.maxOverlayScroll + this.maxZoomScroll;
          return this.scrollAccumulator >= end - 10;
        }

        atZoomStart() {
          return this.scrollAccumulator <= 100;
        }

        setupScroll() {
          let lastTouchY = null;

          const nudge3D = (delta) => {
            this.targetScroll += delta;
            this.targetScroll = Math.max(
              0,
              Math.min(
                this.maxOverlayScroll + this.maxZoomScroll,
                this.targetScroll
              )
            );
          };

          window.addEventListener(
            "wheel",
            (e) => {
              const modal = document.getElementById("projectModal");
              if (modal && modal.classList.contains("is-open")) {
                return;
              }

              const dy = e.deltaY;

              if (
                this.isMobilePortrait &&
                !this.overlayActive &&
                this.galleryProgress === 0 &&
                this.mobileZoomLocked
              ) {
                e.preventDefault();
                this.updateCTAVisibility?.();
                return;
              }

              if (this.overlayActive && this.introPlaying) {
                if (this.isMobilePortrait) {
                  e.preventDefault();
                  return;
                }
                e.preventDefault();
                this.skipIntro("touch");
                return;
              }

              // NEW: fully zoomed IN → scroll up goes back to index
              if (this.galleryProgress === 0 && this.atZoomStart()) {
                e.preventDefault();

                if (dy < 0) {
                  document.body.classList.add("fade-out");
                  setTimeout(() => {
                    window.location.href = "index.html?from=nav";
                  }, 300);
                } else if (dy > 0) {
                  nudge3D(8);
                }

                this.updateCTAVisibility?.();
                return;
              }

              if (this.galleryProgress >= 0.999) {
                e.preventDefault();
                const prev = this.galleryScroller.scrollTop;
                this.galleryScroller.scrollTop += dy;
                if (
                  dy < 0 &&
                  this.galleryScroller.scrollTop <= 0 &&
                  prev <= 0
                ) {
                  this.galleryPull =
                    this.galleryDeadSpace + this.galleryLift - 1;
                  this.galleryProgressTarget = Math.max(
                    0,
                    Math.min(
                      1,
                      (this.galleryPull - this.galleryDeadSpace) /
                        this.galleryLift
                    )
                  );
                }
                return;
              }

              if (this.atZoomEnd() && this.galleryProgress === 0) {
                e.preventDefault();
                if (dy < 0) {
                  nudge3D(-8);
                }
                this.updateCTAVisibility?.();
                return;
              }

              e.preventDefault();
              nudge3D(dy > 0 ? 8 : -8);
            },
            { passive: false }
          );

          window.addEventListener("keydown", (e) => {
            if (this.overlayActive && this.introPlaying) {
              if (this.isMobilePortrait) {
                e.preventDefault();
                return;
              }
              e.preventDefault();
              this.skipIntro("touch");
              return;
            }

            // NEW: fully zoomed IN + gallery closed
            if (this.galleryProgress === 0 && this.atZoomStart()) {
              if (e.key === "ArrowUp" || e.key === "PageUp") {
                e.preventDefault();
                document.body.classList.add("fade-out");
                setTimeout(() => {
                  window.location.href = "index.html?from=nav";
                }, 300);
                return;
              }
              if (e.key === "ArrowDown" || e.key === "PageDown") {
                e.preventDefault();
                this.targetScroll = Math.min(
                  this.maxOverlayScroll + this.maxZoomScroll,
                  this.targetScroll + 8
                );
                return;
              }
            }

            if (this.galleryProgress >= 0.999) {
              if (e.key === "PageDown" || e.key === "ArrowDown") {
                e.preventDefault();
                this.galleryScroller.scrollTop += 120;
                return;
              }
              if (e.key === "PageUp" || e.key === "ArrowUp") {
                e.preventDefault();
                const prev = this.galleryScroller.scrollTop;
                this.galleryScroller.scrollTop -= 120;
                if (this.galleryScroller.scrollTop <= 0 && prev <= 0) {
                  this.galleryPull =
                    this.galleryDeadSpace + this.galleryLift - 1;
                  this.galleryProgressTarget =
                    (this.galleryPull - this.galleryDeadSpace) /
                    this.galleryLift;
                }
                return;
              }
              if (e.key === "Escape") {
                e.preventDefault();
                this.closeGallery();
                return;
              }
            }

            if (this.galleryProgress > 0) {
              if (e.key === "Escape") {
                e.preventDefault();
                this.closeGallery();
                return;
              }
            } else if (this.atZoomEnd()) {
              if (e.key === "PageUp" || e.key === "ArrowUp") {
                e.preventDefault();
                this.targetScroll = Math.max(0, this.targetScroll - 8);
                this.updateCTAVisibility?.();
                return;
              }
              if (
                e.key === "PageDown" ||
                e.key === "ArrowDown" ||
                e.key === " "
              ) {
                e.preventDefault();
                this.updateCTAVisibility?.();
                return;
              }
            }

            if (e.key === "ArrowDown" || e.key === "PageDown") {
              e.preventDefault();
              this.targetScroll = Math.min(
                this.maxOverlayScroll + this.maxZoomScroll,
                this.targetScroll + 8
              );
            }
            if (e.key === "ArrowUp" || e.key === "PageUp") {
              e.preventDefault();
              this.targetScroll = Math.max(0, this.targetScroll - 8);
            }
          });

          window.addEventListener("touchstart", (e) => {
            if (e.touches.length === 1) lastTouchY = e.touches[0].clientY;
          });
          window.addEventListener(
            "touchmove",
            (e) => {
              if (e.touches.length !== 1 || lastTouchY === null) return;

              const dy = lastTouchY - e.touches[0].clientY;
              lastTouchY = e.touches[0].clientY;

              if (
                this.isMobilePortrait &&
                !this.overlayActive &&
                this.galleryProgress === 0 &&
                this.mobileZoomLocked
              ) {
                this.updateCTAVisibility?.();
                e.preventDefault();
                return;
              }

              if (this.overlayActive && this.introPlaying) {
                if (this.isMobilePortrait) {
                  e.preventDefault();
                  return;
                }
                e.preventDefault();
                this.skipIntro("touch");
                return;
              }

              // NEW: fully zoomed IN → swipe down goes back to index
              if (this.galleryProgress === 0 && this.atZoomStart()) {
                e.preventDefault();

                if (dy < 0) {
                  document.body.classList.add("fade-out");
                  setTimeout(() => {
                    window.location.href = "index.html?from=nav";
                  }, 300);
                } else if (dy > 0) {
                  this.targetScroll = Math.min(
                    this.maxOverlayScroll + this.maxZoomScroll,
                    this.targetScroll + 8
                  );
                }

                this.updateCTAVisibility?.();
                return;
              }

              if (this.galleryProgress >= 0.999) {
                this.galleryScroller.scrollTop += dy;
                const atTop = this.galleryScroller.scrollTop <= 0;
                if (dy < 0 && atTop) {
                  this.galleryPull =
                    this.galleryDeadSpace + this.galleryLift - 1;
                  this.galleryProgressTarget =
                    (this.galleryPull - this.galleryDeadSpace) /
                    this.galleryLift;
                }
                e.preventDefault();
                return;
              }

              if (this.atZoomEnd() && this.galleryProgress === 0) {
                if (dy < 0) {
                  this.targetScroll = Math.max(0, this.targetScroll - 8);
                }
                this.updateCTAVisibility?.();
                e.preventDefault();
                return;
              }

              e.preventDefault();
              this.targetScroll += dy > 0 ? 8 : -8;
              this.targetScroll = Math.max(
                0,
                Math.min(
                  this.maxOverlayScroll + this.maxZoomScroll,
                  this.targetScroll
                )
              );
            },
            { passive: false }
          );
        }

        openGallery() {
          this.galleryPull = this.galleryDeadSpace + this.galleryLift;
          this.galleryProgressTarget = 1;
          this.updateCTAVisibility();
        }

        closeGallery() {
          this.galleryPull = 0;
          this.galleryProgressTarget = 0;
          this.updateCTAVisibility();
        }

        addRotateListeners() {
          const controls = this.sceneManager.controls;

          const startHandler = () => {
            if (this.rotateStartTimer) clearTimeout(this.rotateStartTimer);
            this.rotateStartTimer = setTimeout(() => {
              if (this.isMobilePortrait) {
                this.isRotating = false;
                this.targetZoom = null;
                this.currentZoom = null;
                return;
              }
              if (!this.isRotating) {
                this.isRotating = true;
                const cam = this.sceneManager.camera;
                this.preRotateZoom = cam.position.distanceTo(controls.target);
                this.targetZoom = this.preRotateZoom * this.zoomOutFactor;
                this.zoomLerp = 0;
              }
            }, this.controlsStartBufferMs);
          };

          const endHandler = () => {
            if (this.rotateStartTimer) {
              clearTimeout(this.rotateStartTimer);
              this.rotateStartTimer = null;
            }
            if (this.isMobilePortrait) {
              this.isRotating = false;
              this.targetZoom = null;
              this.currentZoom = null;
              return;
            }
            if (this.isRotating) {
              this.isRotating = false;
              this.targetZoom = this.preRotateZoom;
              this.zoomLerp = 0;
              this.shouldOrientAsterisk = true;
            }
          };

          if (this._onControlsStart)
            controls.removeEventListener("start", this._onControlsStart);
          if (this._onControlsEnd)
            controls.removeEventListener("end", this._onControlsEnd);
          controls.addEventListener("start", startHandler);
          controls.addEventListener("end", endHandler);

          this._onControlsStart = startHandler;
          this._onControlsEnd = endHandler;
        }

        getMinCameraZ() {
          return 0.35;
        }
        getMaxCameraZ() {
          return 5.5;
        }

        smoothScrollStep() {
          const now = performance.now();
          const dt = Math.min(1, (now - this.lastFrameTime) / 16.67);
          this.lastFrameTime = now;

          if (this.autoScrollTween) {
            const { start, end, startTime, duration } = this.autoScrollTween;
            const t = Math.min(1, (now - startTime) / duration);
            const k = easeInOutCubic(t);
            this.targetScroll = start + (end - start) * k;
            if (t >= 1) {
              this.autoScrollTween = null;
              this.targetScroll = end;
              this.scrollAccumulator = end;
              this.scrollVelocity = 0;
            }
          }

          if (
            !this.autoScrollTween &&
            this.isMobilePortrait &&
            !this.mobileZoomLocked &&
            !this.overlayActive &&
            this.galleryProgress === 0 &&
            this.atZoomEnd()
          ) {
            this.mobileZoomLocked = true;
            this.updateCTAVisibility();
          }

          const diff = this.targetScroll - this.scrollAccumulator;
          this.scrollVelocity += diff * 0.16 * dt;
          this.scrollVelocity *= 0.68;
          this.scrollAccumulator += this.scrollVelocity * dt;
          this.scrollAccumulator = Math.max(
            0,
            Math.min(
              this.maxOverlayScroll + this.maxZoomScroll,
              this.scrollAccumulator
            )
          );

          const overlayProgress = Math.min(
            1,
            this.scrollAccumulator / this.maxOverlayScroll
          );
          const p = Math.min(
            1,
            this.scrollAccumulator /
              (this.maxOverlayScroll * this.overlayHideThreshold)
          );

          if (this.overlayActive) {
            if (this.overlay) {
              this.overlay.style.transition = "opacity 0s linear";
              this.overlay.style.opacity = String(1 - p);
            }
            if (this.introVideo) {
              this.introVideo.style.transition = "opacity 0s linear";
              this.introVideo.style.opacity = String(1 - p);
            }
          }

          if (this.overlay) {
            const shouldShow =
              !this.overlayActive &&
              overlayProgress < this.overlayShowThreshold;
            const shouldHide =
              this.overlayActive && overlayProgress > this.overlayHideThreshold;

            if (shouldShow) {
              this.overlay.classList.remove("hidden");
              this.overlayActive = true;
              this.overlay.style.transition = "opacity 0s linear";
              this.overlay.style.opacity = "1";
              if (this.introVideo) {
                this.introVideo.style.transition = "opacity 0s linear";
                this.introVideo.style.opacity = "1";
              }
              this.onOverlayShown();
            } else if (shouldHide) {
              this.overlay.classList.add("hidden");
              this.overlayActive = false;
              if (this.overlay) this.overlay.style.opacity = "0";
              if (this.introVideo) this.introVideo.style.opacity = "0";
              this.onOverlayHidden();
            }
          }

          let zoomProgress = 0;
          if (this.scrollAccumulator > this.maxOverlayScroll) {
            const zoomScroll = this.scrollAccumulator - this.maxOverlayScroll;
            zoomProgress = zoomScroll / this.maxZoomScroll;
          }
          zoomProgress = Math.max(0, Math.min(1, zoomProgress));

          const minZ = this.getMinCameraZ();
          const maxZ = this.getMaxCameraZ();
          let z = minZ + (maxZ - minZ) * zoomProgress;

          if (this.targetZoom !== null) {
            if (this.currentZoom === null) this.currentZoom = z;
            this.currentZoom +=
              (this.targetZoom - this.currentZoom) * 0.08 * dt;
            z = this.currentZoom;

            if (Math.abs(this.currentZoom - this.targetZoom) < 0.01) {
              this.currentZoom = this.targetZoom;
              if (!this.isRotating) {
                this.targetZoom = null;
                this.currentZoom = null;
              }
            }
          } else {
            this.currentZoom = null;
          }

          if (zoomProgress < 0.05) {
            this.sceneManager.camera.position.copy(
              this.sceneManager.initialPosition
            );
            this.sceneManager.camera.lookAt(this.sceneManager.initialLookAt);
            this.sceneManager.controls.target.copy(
              this.sceneManager.initialLookAt
            );
          } else {
            const dir = this.sceneManager.camera.position
              .clone()
              .sub(this.sceneManager.controls.target)
              .normalize();
            this.sceneManager.camera.position.copy(
              dir.multiplyScalar(z).add(this.sceneManager.controls.target)
            );
          }

          if (this.asterisk) {
            let orient = false;
            if (zoomProgress < 0.5) orient = true;
            if (this.shouldOrientAsterisk) orient = true;

            if (orient) {
              const asteriskWorldPos = new THREE.Vector3();
              this.asterisk.getWorldPosition(asteriskWorldPos);
              const cameraPos = this.sceneManager.camera.position.clone();
              const target = cameraPos.sub(asteriskWorldPos).normalize();

              const targetY = Math.atan2(target.x, target.z);
              const targetX = Math.asin(-target.y);

              this.asterisk.rotation.x +=
                (targetX - this.asterisk.rotation.x) * 0.18;
              this.asterisk.rotation.y +=
                (targetY - this.asterisk.rotation.y) * 0.18;

              if (this.shouldOrientAsterisk) {
                if (
                  Math.abs(this.asterisk.rotation.x - targetX) < 0.03 &&
                  Math.abs(this.asterisk.rotation.y - targetY) < 0.03
                ) {
                  this.asterisk.rotation.x = targetX;
                  this.asterisk.rotation.y = targetY;
                  this.shouldOrientAsterisk = false;
                }
              }
            } else {
              this.asterisk.rotation.y += 0.01;
              this.asterisk.rotation.x += 0.007;
            }
          }

          this.updateGalleryFrame(dt);
          this.updateCTAVisibility();
        }

        updateGalleryFrame(dt) {
          this.galleryProgress +=
            (this.galleryProgressTarget - this.galleryProgress) * 0.18;
          if (
            Math.abs(this.galleryProgress - this.galleryProgressTarget) < 0.001
          ) {
            this.galleryProgress = this.galleryProgressTarget;
          }

          const y = 100 - this.galleryProgress * 100;
          if (this.isMobilePortrait) {
            this.galleryEl.style.transform = `translateY(${y}%)`;
          } else {
            this.galleryEl.style.transform = `translateX(-50%) translateY(${y}%)`;
          }
          const op = 0.2 + this.galleryProgress * 0.8;
          this.galleryEl.style.opacity = op.toFixed(3);

          const wasOpen = !!this._wasGalleryOpen;
          const isOpen = this.galleryProgress >= 0.98;

          if (isOpen) {
            this.galleryEl.style.pointerEvents = "auto";
            if (!wasOpen) this.pauseHeavy();
          } else {
            this.galleryEl.style.pointerEvents = "none";
            if (wasOpen) this.resumeHeavy();
          }

          if (isOpen !== wasOpen) {
            window.syncGalleryVars?.();
            window.galleryLayout?.();
          }
          this._wasGalleryOpen = isOpen;
        }

        updateCTAVisibility() {
          const shouldShow =
            !this.overlayActive &&
            this.galleryProgress <= 0.001 &&
            this.atZoomEnd();

          if (this.galleryCTA) {
            this.galleryCTA.classList.toggle("is-visible", !!shouldShow);
          }
        }

        animateAsterisk() {}

        animateRects() {
          if (this.rotationEnabled && this.orbitingRects)
            this.orbitingRects.animate(true);
        }

        billboardVideosToCamera() {
          if (!this.orbitingRects || !this.orbitingRects.rects?.length) return;

          const cam = this.sceneManager.camera;

          const camForward = new THREE.Vector3();
          cam.getWorldDirection(camForward);

          const camUp = new THREE.Vector3(0, 1, 0)
            .applyQuaternion(cam.quaternion)
            .normalize();

          const zAxis = camForward.clone().negate();
          const xAxis = new THREE.Vector3()
            .crossVectors(camUp, zAxis)
            .normalize();
          const yAxis = new THREE.Vector3()
            .crossVectors(zAxis, xAxis)
            .normalize();

          this._billboardMat = this._billboardMat || new THREE.Matrix4();
          this._billboardQuatWorld =
            this._billboardQuatWorld || new THREE.Quaternion();
          this._tmpParentQuat = this._tmpParentQuat || new THREE.Quaternion();
          this._tmpLocalQuat = this._tmpLocalQuat || new THREE.Quaternion();

          this._billboardMat.makeBasis(xAxis, yAxis, zAxis);
          this._billboardQuatWorld.setFromRotationMatrix(this._billboardMat);

          for (const rect of this.orbitingRects.rects) {
            if (rect.parent)
              rect.parent.getWorldQuaternion(this._tmpParentQuat);
            else this._tmpParentQuat.identity();

            this._tmpLocalQuat
              .copy(this._tmpParentQuat)
              .invert()
              .multiply(this._billboardQuatWorld);

            if ((rect.quaternion.angleTo(this._tmpLocalQuat) || 0) > 1e-4) {
              rect.quaternion.copy(this._tmpLocalQuat);
            }
          }
        }

        computeMobilePortrait() {
          const coarsePortrait = window.matchMedia?.(
            "(pointer: coarse) and (orientation: portrait)"
          )?.matches;
          const narrowPortrait =
            window.innerWidth <= 768 && window.innerHeight > window.innerWidth;
          return !!(coarsePortrait || narrowPortrait);
        }

        applyMobileControls() {
          const controls = this.sceneManager?.controls;
          if (!controls) return;
          controls.enableZoom = !this.isMobilePortrait;

          if (this.isMobilePortrait) {
            this.isRotating = false;
            this.targetZoom = null;
            this.currentZoom = null;
          }
        }
      }

      const app = new App();
      window.App = app;
    </script>

    <script>
      window.openMenu =
        window.openMenu ||
        function () {
          const nav = document.querySelector(".navigation");
          const btn = document.querySelector(".hamburger");
          if (nav) nav.classList.toggle("is-active");
          if (btn) btn.classList.toggle("is-open");
        };

      window.openSubpage =
        window.openSubpage ||
        function (pageNumber) {
          if (window.App && typeof window.App.openGallery === "function") {
            window.App.openGallery();
          }
          const scroller = document.getElementById("galleryScroll");
          const card = document.querySelector(
            `.projectCard[data-page="${pageNumber}"]`
          );
          if (card) {
            card.classList.add("expanded");
            setTimeout(() => {
              card.scrollIntoView({ behavior: "auto", block: "start" });
              if (scroller) scroller.focus({ preventScroll: true });
            }, 0);
          }
        };
    </script>

    <script>
      window.addEventListener("gallery:openRequested", () => {
        if (window.App && typeof window.App.openGallery === "function") {
          window.App.openGallery();
        }
      });

      window.addEventListener("gallery:mobileZoomOut", () => {
        if (window.App && typeof window.App.setGalleryZoom === "function") {
          try {
            window.App.setGalleryZoom("out");
          } catch (e) {}
        }
      });
    </script>

    <script>
      function closeMenuAndGoHome() {
        const nav = document.querySelector(".navigation");
        const btn = document.querySelector(".hamburger");
        if (nav) nav.classList.remove("is-active");
        if (btn) btn.classList.remove("is-open");

        const currentPage =
          window.location.pathname.split("/").pop() || "index.html";

        if (currentPage === "index.html" || currentPage === "") {
          if (window.App) {
            window.App.closeGallery();
            window.App.targetScroll = 0;
            window.App.scrollAccumulator = 0;
          }
        } else {
          document.body.classList.add("fade-out");
          setTimeout(() => {
            window.location.href = "index.html?from=nav";
          }, 400);
        }
      }

      function closeMenuAndOpenGallery() {
        const nav = document.querySelector(".navigation");
        const btn = document.querySelector(".hamburger");
        if (nav) nav.classList.remove("is-active");
        if (btn) btn.classList.remove("is-open");

        if (window.App && typeof window.App.openGallery === "function") {
          window.App.openGallery();
        }
      }
    </script>
  </body>
</html>
