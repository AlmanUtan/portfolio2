<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elia RÃ¶mpler - Portfolio</title>
    <link rel="icon" type="image/png" href="public/img/IMG_6999.PNG" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://use.typekit.net/yyn5dss.css" />
  </head>

  <body>
    <!-- Move hamburger OUTSIDE the transformed .navigation -->
    <button
      class="hamburger"
      type="button"
      aria-label="Open menu"
      onclick="openMenu()"
      id="hamburgerBtn"
    >
      <div id="bar1" class="bar"></div>
      <div id="bar2" class="bar"></div>
      <div id="bar3" class="bar"></div>
    </button>

    <div class="navigation">
      <nav>
        <ul>
          <li>
            <a href="asterisk.html">Home</a>
          </li>
          <li>
            <a href="#" onclick="closeMenuAndOpenGallery(); return false;"
              >Gallery</a
            >
          </li>
          <li><a href="about.html">About</a></li>
        </ul>
      </nav>

      <div class="socials">
        <a
          href="https://www.linkedin.com/in/elia-r%C3%B6mpler-5b4b9823b/"
          target="_blank"
          >LinkedIn</a
        >
        <a href="https://www.instagram.com/elia.roempler/" target="_blank"
          >Instagram</a
        >
        <a href="elia.roempler@gmail.com" target="_blank">E-mail</a>
      </div>

      <div class="asterisk-image">
        <img src="public/img/IMG_6999.PNG" alt="asterisk" />
      </div>
    </div>

    <!-- Intro overlay with video -->
    <div id="start-overlay" aria-hidden="false">
      <video
        id="introVideo"
        autoplay
        muted
        playsinline
        webkit-playsinline
        x5-playsinline
        preload="auto"
      >
        <source src="public/vid/Main3.mp4" type="video/mp4" />
      </video>
      <!-- Small mute/unmute toggle in top-right -->
      <button></button>
      <!-- Fallback play button if autoplay is blocked -->
      <button id="introPlayBtn" aria-label="Play intro" hidden>Play</button>
    </div>

    <!-- Your UI/gallery/masonry JS -->
    <script src="script.js"></script>

    <script>
      // Redirect to asterisk page after video fade
      (function () {
        const overlay = document.getElementById("start-overlay");
        const video = document.getElementById("introVideo");

        if (!overlay || !video) return;

        let scrollAccumulator = 0;
        const maxScroll = 100; // Distance to fade out video
        let targetScroll = 0;
        let scrollVelocity = 0;
        let lastFrameTime = performance.now();
        let hasRedirected = false;

        // Smooth scroll physics
        function updateScroll() {
          const now = performance.now();
          const dt = Math.min(1, (now - lastFrameTime) / 16.67);
          lastFrameTime = now;

          const diff = targetScroll - scrollAccumulator;
          scrollVelocity += diff * 0.16 * dt;
          scrollVelocity *= 0.68;
          scrollAccumulator += scrollVelocity * dt;
          scrollAccumulator = Math.max(
            0,
            Math.min(maxScroll, scrollAccumulator)
          );

          // Calculate fade progress
          const fadeProgress = Math.min(1, scrollAccumulator / maxScroll);
          const opacity = 1 - fadeProgress;

          // Apply fade
          overlay.style.opacity = opacity.toFixed(3);
          video.style.opacity = opacity.toFixed(3);

          // Redirect when fully faded
          if (fadeProgress >= 0.98 && !hasRedirected) {
            hasRedirected = true;
            setTimeout(() => {
              window.location.href = "asterisk.html";
            }, 200);
          }

          requestAnimationFrame(updateScroll);
        }

        // Start animation loop
        updateScroll();

        // Scroll handlers
        function nudgeScroll(delta) {
          targetScroll += delta;
          targetScroll = Math.max(0, Math.min(maxScroll, targetScroll));
        }

        // Wheel
        window.addEventListener(
          "wheel",
          (e) => {
            e.preventDefault();
            nudgeScroll(e.deltaY > 0 ? 8 : -8);
          },
          { passive: false }
        );

        // Touch
        let lastTouchY = null;
        window.addEventListener("touchstart", (e) => {
          if (e.touches.length === 1) lastTouchY = e.touches[0].clientY;
        });
        window.addEventListener(
          "touchmove",
          (e) => {
            if (e.touches.length !== 1 || lastTouchY === null) return;
            const dy = lastTouchY - e.touches[0].clientY;
            lastTouchY = e.touches[0].clientY;
            e.preventDefault();
            nudgeScroll(dy > 0 ? 8 : -8);
          },
          { passive: false }
        );

        // Keyboard
        window.addEventListener("keydown", (e) => {
          if (e.key === "ArrowDown" || e.key === "PageDown" || e.key === " ") {
            e.preventDefault();
            nudgeScroll(8);
          }
          if (e.key === "ArrowUp" || e.key === "PageUp") {
            e.preventDefault();
            nudgeScroll(-8);
          }
        });

        // Double-tap to skip (mobile)
        let lastTapTime = 0;
        overlay.addEventListener("touchend", (e) => {
          const now = performance.now();
          if (now - lastTapTime < 300) {
            e.preventDefault();
            targetScroll = maxScroll;
          }
          lastTapTime = now;
        });
      })();
    </script>
  </body>
</html>
